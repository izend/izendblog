<?php

/**
 *
 * @copyright  2010-2012 izend.org
 * @version    10
 * @link       http://www.izend.org
 */
?>
<?php extract($errors); ?>
<form action="" method="post">
<input name="clang" type="hidden" value="<?php echo $clang; ?>" />
<p>
<input class="submit_add" id="content_create" name="content_create" type="submit" value="Add" />
a type
<?php
$selected=$new_content_type ? $new_content_type : 'text';
?>
<select id="content_new_type" name="content_new_type" size="1">
<option value="text" <?php echo $selected == 'text' ? 'selected="selected"' : ''; ?>>Text</option>
<?php foreach ($supported_contents as $type): ?>
<?php if ($type == 'infile'): ?>
<option value="infile" <?php echo $selected == 'infile' ? 'selected="selected"' : ''; ?>>Insertion</option>
<?php elseif ($type == 'download'): ?>
<option value="download" <?php echo $selected == 'download' ? 'selected="selected"' : ''; ?>>Download</option>
<?php elseif ($type == 'file'): ?>
<option value="file" <?php echo $selected == 'file' ? 'selected="selected"' : ''; ?>>File</option>
<?php elseif ($type == 'longtail'): ?>
<option value="longtail" <?php echo $selected == 'longtail' ? 'selected="selected"' : ''; ?>>LongTail</option>
<?php endif; ?>
<?php endforeach; ?>
</select>
#
<input id="content_new_number" name="content_new_number" type="text" size="2" maxlength="3" value="<?php echo htmlspecialchars($new_content_number, ENT_COMPAT, 'UTF-8'); ?>" title="Number"/>
<?php if ($node_contents): ?>
or
<input class="submit_delete" id="content_delete" name="content_delete" type="submit" value="Delete" />
#
<input id="content_old_number" name="content_old_number" type="text" size="2" maxlength="3" value="<?php echo htmlspecialchars($old_content_number, ENT_COMPAT, 'UTF-8'); ?>" title="Number"/>
<?php endif; ?>
</p>
<?php if ($node_contents): ?>
<?php
$i=1;
foreach ($node_contents as $c) {
	$content_text_text='';
	$content_text_eval=false;
	$content_infile_path=false;
	$content_download_name=$content_download_path=false;
	$content_file_path=$content_file_format=$content_file_lineno=false;
	$content_file_start=$content_file_end=0;
	$content_longtail_file=$content_longtail_image=false;
	$content_longtail_width=$content_longtail_height=0;
	$content_longtail_skin=false;
	$content_longtail_controlbar='none';
	$content_longtail_icons=false;
	$content_longtail_duration=0;
	$content_longtail_autostart=$content_longtail_repeat=false;
	extract($c);	/* content_id content_number content_ignored content_type  ... */
?>
<p class="<?php echo $content_ignored ? 'ignored' : (($i % 2) ? 'odd' : 'even'); ?>">
<input name="content_id[<?php echo $i; ?>]" type="hidden" value="<?php echo $content_id; ?>"/>
<input name="content_p[<?php echo $i; ?>]" type="text" size="2" maxlength="3" value="<?php echo htmlspecialchars($content_pos, ENT_COMPAT, 'UTF-8'); ?>"/>
<input name="content_ignored[<?php echo $i; ?>]" type="checkbox" <?php if ($content_ignored) echo 'checked="checked"'; ?> /><img src="<?php echo $base_path; ?>/images/theme/edit/cross.png" alt="ignored" title="Ignored" />
<?php switch ($content_type): ?>
<?php case 'text': ?>
<label>Text:</label>
<?php break; ?>
<?php case 'infile': ?>
<label>Insertion:</label>
<?php break; ?>
<?php case 'download': ?>
<label>Download:</label>
<?php break; ?>
<?php case 'file': ?>
<label>File:</label>
<?php break; ?>
<?php case 'longtail': ?>
<label>LongTail:</label>
<?php break; ?>
<?php endswitch; ?>
</p>
<?php switch ($content_type): ?>
<?php case 'text': ?>
<div class="tagbar">
<img src="<?php echo $base_path; ?>/images/theme/edit/p.png" alt="&lt;p&gt;" title="p" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;p&gt;','&lt;/p&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/b.png" alt="&lt;b&gt;" title="b" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;b&gt;','&lt;/b&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/i.png" alt="&lt;i&gt;" title="i" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;i&gt;','&lt;/i&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/u.png" alt="&lt;u&gt;" title="u" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;u&gt;','&lt;/u&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/s.png" alt="&lt;s&gt;" title="s" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;s&gt;','&lt;/s&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/h4.png" alt="&lt;h4&gt;" title="h4" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;h4&gt;','&lt;/h4&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/h5.png" alt="&lt;h5&gt;" title="h5" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;h5&gt;','&lt;/h5&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/h6.png" alt="&lt;h6&gt;" title="h6" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;h6&gt;','&lt;/h6&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/br.png" alt="&lt;br&gt;" title="br" onclick="addtag('content_text_text_<?php echo $i; ?>', '','&lt;br /&gt;\n')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/ol.png" alt="&lt;ol&gt;" title="ol" onclick="addtag('content_text_text_<?php echo $i; ?>', '','&lt;ol&gt;\n&lt;li&gt;&lt;/li&gt;\n&lt;/ol&gt;\n')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/ul.png" alt="&lt;ul&gt;" title="ul" onclick="addtag('content_text_text_<?php echo $i; ?>', '','&lt;ul&gt;\n&lt;li&gt;&lt;/li&gt;\n&lt;/ul&gt;\n')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/table.png" alt="&lt;table&gt;" title="table" onclick="addtag('content_text_text_<?php echo $i; ?>', '','&lt;table&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/fixed.png" alt="&lt;code&gt;" title="code" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;code&gt;','&lt;/code&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/shell.png" alt="&lt;pre&gt;&lt;code&gt;" title="pre code" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;pre&gt;&lt;code&gt;','&lt;/code&gt;&lt;/pre&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/quote.png" alt="&lt;blockquote&gt;" title="blockquote" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;blockquote&gt;','&lt;/blockquote&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/img.png" alt="&lt;img&gt;" title="img" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;img src=\x22','\x22 alt=\x22\x22 title=\x22\x22 /&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/world.png" alt="&lt;a&gt;" title="a" onclick="addtag('content_text_text_<?php echo $i; ?>', '&lt;a href=\x22#\x22&gt;','&lt;/a&gt;')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/entquote.png" alt="entquote" title="entquote" onclick="entquote('content_text_text_<?php echo $i; ?>')"/>
<img src="<?php echo $base_path; ?>/images/theme/edit/striptags.png" alt="striptags" title="striptags" onclick="striptags('content_text_text_<?php echo $i; ?>')"/>
<span><input name="content_text_eval[<?php echo $i; ?>]" type="checkbox" <?php if ($content_text_eval) echo 'checked="checked"'; ?> /><img src="<?php echo $base_path; ?>/images/theme/edit/code.png" alt="PHP" title="seval" /></span>
</div>
<textarea id="content_text_text_<?php echo $i; ?>" name="content_text_text[<?php echo $i; ?>]" cols="100" rows="8"><?php echo htmlspecialchars($content_text_text, ENT_COMPAT, 'UTF-8'); ?></textarea>
<br/><img class="grippie" src="<?php echo $base_path; ?>/images/theme/edit/grippie.png" alt="===" />
<?php break; ?>
<?php case 'infile': ?>
<p>
<input name="content_infile_path[<?php echo $i; ?>]" type="text" size="40" maxlength="200" value="<?php echo htmlspecialchars($content_infile_path, ENT_COMPAT, 'UTF-8'); ?>" title="File" />
</p>
<?php break; ?>
<?php case 'download': ?>
<p>
<input name="content_download_name[<?php echo $i; ?>]" type="text" size="20" maxlength="50" value="<?php echo htmlspecialchars($content_download_name, ENT_COMPAT, 'UTF-8'); ?>" title="Name" />
<input name="content_download_path[<?php echo $i; ?>]" type="text" size="40" maxlength="200" value="<?php echo htmlspecialchars($content_download_path, ENT_COMPAT, 'UTF-8'); ?>" title="File" />
</p>
<?php break; ?>
<?php case 'file': ?>
<p>
<input name="content_file_path[<?php echo $i; ?>]" type="text" size="40" maxlength="200" value="<?php echo htmlspecialchars($content_file_path, ENT_COMPAT, 'UTF-8'); ?>" title="File" />
<input name="content_file_start[<?php echo $i; ?>]" type="text" size="5" maxlength="5" value="<?php echo htmlspecialchars($content_file_start, ENT_COMPAT, 'UTF-8'); ?>" title="Start" />
<input name="content_file_end[<?php echo $i; ?>]" type="text" size="5" maxlength="5" value="<?php echo htmlspecialchars($content_file_end, ENT_COMPAT, 'UTF-8'); ?>" title="End" />
<input name="content_file_format[<?php echo $i; ?>]" type="text" size="10" maxlength="20" value="<?php echo htmlspecialchars($content_file_format, ENT_COMPAT, 'UTF-8'); ?>" title="Format" />
<input name="content_file_lineno[<?php echo $i; ?>]" type="checkbox" <?php if ($content_file_lineno) echo 'checked="checked"'; ?> /><img src="<?php echo $base_path; ?>/images/theme/edit/ol.png" alt="number" title="Number" />
</p>
<?php break; ?>
<?php case 'longtail': ?>
<p>
<input name="content_longtail_file[<?php echo $i; ?>]" type="text" size="40" maxlength="200" value="<?php echo htmlspecialchars($content_longtail_file, ENT_COMPAT, 'UTF-8'); ?>" title="File" />
<input name="content_longtail_width[<?php echo $i; ?>]" type="text" size="5" maxlength="5" value="<?php echo htmlspecialchars($content_longtail_width, ENT_COMPAT, 'UTF-8'); ?>" title="Width" />
x
<input name="content_longtail_height[<?php echo $i; ?>]" type="text" size="5" maxlength="5" value="<?php echo htmlspecialchars($content_longtail_height, ENT_COMPAT, 'UTF-8'); ?>" title="Height" />
<img src="<?php echo $base_path; ?>/images/theme/edit/time.png" alt="Duration: " />
<input name="content_longtail_duration[<?php echo $i; ?>]" type="text" size="5" maxlength="5" value="<?php echo htmlspecialchars($content_longtail_duration, ENT_COMPAT, 'UTF-8'); ?>" title="Duration" />
<input name="content_longtail_autostart[<?php echo $i; ?>]" type="checkbox" <?php if ($content_longtail_autostart) echo 'checked="checked"'; ?> /><img src="<?php echo $base_path; ?>/images/theme/edit/play.png" alt="auto" title="Auto" /><input name="content_longtail_repeat[<?php echo $i; ?>]" type="checkbox" <?php if ($content_longtail_repeat) echo 'checked="checked"'; ?> /><img src="<?php echo $base_path; ?>/images/theme/edit/repeat.png" alt="loop" title="Loop" />
</p>
<p>
<input name="content_longtail_image[<?php echo $i; ?>]" type="text" size="40" maxlength="200" value="<?php echo htmlspecialchars($content_longtail_image, ENT_COMPAT, 'UTF-8'); ?>" title="Picture" />
<input name="content_longtail_icons[<?php echo $i; ?>]" type="checkbox" <?php if ($content_longtail_icons) echo 'checked="checked"'; ?> /><img src="<?php echo $base_path; ?>/images/theme/edit/imgplay.png" alt="icons" title="Icons" />
</p>
<p>
<input name="content_longtail_skin[<?php echo $i; ?>]" type="text" size="40" maxlength="200" value="<?php echo htmlspecialchars($content_longtail_skin, ENT_COMPAT, 'UTF-8'); ?>" title="Skin" />
<select name="content_longtail_controlbar[<?php echo $i; ?>]" title="Control bar">
<?php foreach (array('none' => 'none', 'over' => 'over', 'top' => 'top', 'bottom' => 'bottom') as $cb => $tr): ?>
<option value="<?php echo $cb; ?>"<?php if ($content_longtail_controlbar == $cb) : ?> selected="selected"<?php endif; ?>><?php echo $tr; ?></option>
<?php endforeach; ?>
</select>
</p>
<?php break; ?>
<?php endswitch; ?>
<?php
	$i++;
}
?>
<p>
<input class="submit_modify" id="content_modify" name="content_modify" type="submit" value="Modify" />
contents
</p>
<?php endif; ?>
</form>
<?php
$focus=false;
if ($bad_new_content_number) {
	 $focus='#content_new_number';
}
else if ($missing_old_content_number or $bad_old_content_number) {
	 $focus='#content_old_number';
}
?>
<?php if ($focus): ?>
<?php head('javascript', 'jquery.scrollTo', 'screen'); ?>
<script type="text/javascript">
$(function() {$('<?php echo $focus; ?>').focus(); $.scrollTo('<?php echo $focus; ?>', {offset: -200}); });
</script>
<?php endif; ?>
<script type="text/javascript">
$(document).ready(function() {
	$('.grippie').each(function() {
		var grippie = $(this);
		var textarea = grippie.prev().prev();
		var offset;

		grippie.mousedown(startDrag);

	    function startDrag(e) {
	      offset = textarea.height() - e.pageY;
	      textarea.css('opacity', 0.25);
	      $(document).mousemove(performDrag).mouseup(endDrag);
	      return false;
	    }

	    function performDrag(e) {
	      textarea.height(Math.max(32, offset + e.pageY) + 'px');
	      return false;
	    }

	    function endDrag(e) {
	      $(document).unbind('mousemove', performDrag).unbind('mouseup', endDrag);
	      textarea.css('opacity', 1);
	    }
	});
});
</script>
